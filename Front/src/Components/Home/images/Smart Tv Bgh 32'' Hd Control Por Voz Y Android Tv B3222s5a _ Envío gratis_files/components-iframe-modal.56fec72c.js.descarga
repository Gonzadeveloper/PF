(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[12212],{39711:(e,a,t)=>{var o=t(16270);t(74423);t(96540);const{useState:s,useEffect:i,useRef:l}=t(96540),{bool:n,string:r,func:d,shape:c,number:m}=t(5556),{Modal:u}=t(57937),_=t(46942),g=t(81762),f=t(35122),{trackEvent:p}=t(800),E=t(99511),b=t(81821),{eventTypes:S}=t(25824),{VPP_SEQUENCER_DATADOG_KEY_CASES:A}=t(76147),{REASON_TAG_VALUES:T}=t(66146),{updateOnePayForAllTrack:I,ACTIONS_SEQUENCER_TRACK:k}=t(31018),{MSG_LOADED:C,MSG_LOADING:L,MSG_CLOSE_BTN:v,MSG_REDIRECT:w,MSG_NAVIGATE:h,MSG_CLOSE:D,MSG_SNACKBAR:M,MSG_ASK_QUESTION:O}=S,y=e=>{let{id:a,src:t,title:n,show:r,deviceType:d,fallbackConfig:c,statsdConfig:m,isDismissible:S,isFlowRedirect:y,showSnackbar:G,bottomSheetClose:N,updateIframeModal:R,updateComponentsBottomSheet:B,onCloseVariations:U,onCreateQuestionFromAi:K,saveFrontendStatsd:x,sequencerTrack:F}=e;const V=l(null),[W,q]=s(!1),[Q,P]=s(null),H=t&&t.includes("questions-ai"),z="mobile"===d?H?"small":"card":"large",{keyPrefix:Y,baseTags:$}=m||{},{fallbackUrl:j,fallbackMessage:J,timeoutInitialLoad:X,timeoutWebviewMessage:Z}=c||{},ee=e=>{let{key:a,aditionalTags:t={},aditionalInfo:o,shouldLogMessage:s}=e;x&&Y&&$&&x({key:`${Y}.${a}`,tags:{...$,...t},info:s&&o})},ae=e=>{let{message:a,aditionalTags:t={},aditionalInfo:o,shouldLogMessage:s}=e;ee({key:A.SHOW_SNACKBAR,aditionalTags:{snackbar_type:"error",...t},aditionalInfo:o,shouldLogMessage:s}),G({message:a,type:"error"})},te=e=>{let{url:a,target:t,newIsDismissible:o,newFallbackConfig:s}=e;a&&b({target:a,currentLocation:window.location})?("parent"===t&&(window.location.href=a),"modal"===t&&R&&(q(!1),P(null),R({src:a,fallbackConfig:s,isDismissible:o,isFlowRedirect:!0}))):ae({aditionalTags:{reason:T.INVALID_REDIRECT_URL},aditionalInfo:{url:a,target:t},shouldLogMessage:!0})},oe=()=>{U&&U(),N&&N(),Q&&(p(Q),P(null))},se=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{trackData:a=null,refreshCartIcon:t=!1,shouldUpdateComponents:o=!1,disableClose:s=!1}=e;var i;clearTimeout(V.current),q(!0),s&&R({isDismissible:!1}),a&&P({melidata_event:{...a}}),F&&p(I(F,k.LOADED)),ee({key:A.FLOW_END,aditionalTags:{end_case:y?"bottomsheet_redirect":"bottomsheet"}}),t&&(null===(i=f.freya)||void 0===i||i.emit("cart:refresh")),o&&B&&B()},ie=e=>{var a;if(null!=e&&null!==(a=e.data)&&void 0!==a&&a.type)switch(e.data.type){case C:se(e.data.data);break;case L:q(!1);break;case v:R({isDismissible:e.data.enabled});break;case w:te({url:e.data.redirectUrl,target:"parent"});break;case h:!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{url:a,fallback:t,fallback_message:o,timeout:s,timeout_webview_message:i,is_dismissible:l}=e;te({url:a,target:"modal",newFallbackConfig:{...c,fallbackUrl:t,fallbackMessage:o,timeoutInitialLoad:s,timeoutWebviewMessage:i},newIsDismissible:l})}(e.data);break;case D:oe();break;case M:e.data.snackbar&&G&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{snackbar:a,close:t}=e,{message:o,type:s,delay:i,called_from:l,action:n}=a;t&&oe(),n&&(n.onClick=()=>te({url:n.redirectUrl,target:"parent"})),G({message:o,type:s,delay:i,called_from:l,action:n})}(e.data);break;case O:e.data.question&&e.data.itemId&&K&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};oe(),K({itemId:e.itemId,text:e.question,snackbar_message:e.snackbar_message,suggestionTrack:e.track})}(e.data)}};i((()=>{t&&c&&(V.current=setTimeout((()=>{F&&p(I(F)),j&&b({target:j,currentLocation:window.location})?(ee({key:A.REDIRECT_TO_FALLBACK,aditionalTags:{reason:T.TIMEOUT_INITIAL_LOAD,flow_redirect:Boolean(y)}}),window.location.href=j):(ae({message:null==J?void 0:J.message,aditionalTags:{reason:T.TIMEOUT_INITIAL_LOAD,flow_redirect:Boolean(y)}}),oe())}),X||1e4))}),[t]),i((()=>(r||q(!1),U&&r&&(document.querySelector(".ui-pdp-backdrop-modal").setAttribute("style","height:0px"),document.querySelectorAll(".andes-modal__overlay")[0].setAttribute("style","height:0px")),f.addEventListener("message",ie),()=>{f.removeEventListener("message",ie),clearTimeout(V.current)})),[r]);const le=_("iframe-modal-congrats",{"iframe-modal-congrats--desktop":"large"===z,"iframe-modal-congrats--mobile":"large"!==z,"iframe-modal-questions-ai":H});return o(u,{open:r,id:a,onClose:oe,type:z,title:n||" ",className:le,closable:W&&!1!==S},void 0,o(E,{title:"iframe","data-testid":"iframe-element",src:t,showSpinner:!0,forceSpinner:!W,spinnerClassname:"center-spinner",onLoad:()=>{clearTimeout(V.current),c&&(V.current=setTimeout((()=>{F&&p(I(F)),j&&b({target:j,currentLocation:window.location})?(ee({key:A.REDIRECT_TO_FALLBACK,aditionalTags:{reason:T.TIMEOUT_WEBVIEW_MESSAGE,flow_redirect:Boolean(y)}}),window.location.href=j):(ae({message:null==J?void 0:J.message,aditionalTags:{reason:T.TIMEOUT_WEBVIEW_MESSAGE,flow_redirect:Boolean(y)}}),oe())}),Z||5e3))},onMessage:g("vpp:iframe-modal:resize","height",".ui-pdp-iframe-modal",".andes-modal__header")}))};y.defaultProps={id:"",title:"",show:!1,fallbackConfig:null,statsdConfig:null,isDismissible:!0,updateComponentsBottomSheet:null,onCloseVariations:null,onCreateQuestionFromAi:null,showSnackbar:null,saveFrontendStatsd:null},e.exports=y},25824:e=>{const a={MSG_LOADED:"vpp:iframe-modal:loaded",MSG_LOADING:"vpp:iframe-modal:loading",MSG_CLOSE_BTN:"vpp:iframe-modal:close_button",MSG_REDIRECT:"vpp:iframe-modal:redirect",MSG_NAVIGATE:"vpp:iframe-modal:navigate",MSG_CLOSE:"vpp:iframe-modal:close",MSG_SNACKBAR:"vpp:iframe-modal:snackbar",MSG_ASK_QUESTION:"vpp:iframe-modal:ask-question"};e.exports={eventTypes:a,KEY_TRACKS:{INITIAL_LOAD:"initial_load",WEBVIEW_EVENT:"webview_event"}}},78579:(e,a,t)=>{const{Iframe:o}=t(96561);e.exports=o},99511:(e,a,t)=>{const o=t(78579);e.exports=o},35122:(e,a,t)=>{"object"==typeof window?e.exports=window:e.exports=t.g},81762:(e,a,t)=>{const{onIframeModalResize:o}=t(57122);e.exports=o},81821:(e,a,t)=>{const{targetHostnameValidator:o}=t(57122);e.exports=o}}]);
//# sourceMappingURL=components-iframe-modal.56fec72c.js.map